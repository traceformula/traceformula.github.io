<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game of Life + Image</title>
  <style>
    html, body {
      margin: 0;
      background: #111;
      overflow: hidden;
      font-family: sans-serif;
      color: white;
    }
    canvas {
      display: block;
      background: #222;
    }
    #controls {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 12px;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    button, input[type="file"] {
      font-size: 14px;
      padding: 4px 8px;
      margin-top: 2px;
    }
  </style>
</head>
<body>

<div id="controls">
  <button id="startStopBtn">Start</button>
  <button id="clearBtn">Clear</button>
  <label>
    Upload Image:
    <input type="file" id="imageInput" accept="image/*">
  </label>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Fullscreen canvas
let width = window.innerWidth;
let height = window.innerHeight;
canvas.width = width;
canvas.height = height;

// Settings
const CELL_SIZE = 10;
const COLS = Math.floor(width / CELL_SIZE);
const ROWS = Math.floor(height / CELL_SIZE);

let grid = createEmptyGrid();
let running = false;
let interval = null;

function createEmptyGrid() {
  const grid = [];
  for (let y = 0; y < ROWS; y++) {
    grid[y] = [];
    for (let x = 0; x < COLS; x++) {
      grid[y][x] = 0;
    }
  }
  return grid;
}

function drawGrid() {
  ctx.clearRect(0, 0, width, height);
  ctx.fillStyle = '#00ff88';

  for (let y = 0; y < ROWS; y++) {
    for (let x = 0; x < COLS; x++) {
      if (grid[y][x] === 1) {
        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
      }
    }
  }
}

function countNeighbors(grid, x, y) {
  let count = 0;
  for (let dy = -1; dy <= 1; dy++) {
    for (let dx = -1; dx <= 1; dx++) {
      if (dx === 0 && dy === 0) continue;
      const nx = x + dx;
      const ny = y + dy;
      if (nx >= 0 && nx < COLS && ny >= 0 && ny < ROWS) {
        count += grid[ny][nx];
      }
    }
  }
  return count;
}

function update() {
  const newGrid = createEmptyGrid();

  for (let y = 0; y < ROWS; y++) {
    for (let x = 0; x < COLS; x++) {
      const neighbors = countNeighbors(grid, x, y);
      const alive = grid[y][x] === 1;

      if (alive && (neighbors === 2 || neighbors === 3)) {
        newGrid[y][x] = 1;
      } else if (!alive && neighbors === 3) {
        newGrid[y][x] = 1;
      }
    }
  }

  grid = newGrid;
  drawGrid();
}

const startStopBtn = document.getElementById('startStopBtn');
startStopBtn.addEventListener('click', () => {
  running = !running;
  startStopBtn.textContent = running ? 'Pause' : 'Start';

  if (running) {
    interval = setInterval(update, 100);
  } else {
    clearInterval(interval);
  }
});

document.getElementById('clearBtn').addEventListener('click', () => {
  grid = createEmptyGrid();
  drawGrid();
});

canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) / CELL_SIZE);
  const y = Math.floor((e.clientY - rect.top) / CELL_SIZE);
  grid[y][x] = grid[y][x] === 1 ? 0 : 1;
  drawGrid();
});

// --- ðŸ“· Image Upload + Grid Conversion ---
document.getElementById('imageInput').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const img = new Image();
  const reader = new FileReader();
  reader.onload = function(event) {
    img.src = event.target.result;
  };
  reader.readAsDataURL(file);

  img.onload = () => {
    // Draw image to off-screen canvas
    const tempCanvas = document.createElement('canvas');
    const tempCtx = tempCanvas.getContext('2d');
    tempCanvas.width = COLS;
    tempCanvas.height = ROWS;
    tempCtx.drawImage(img, 0, 0, COLS, ROWS);

    const imageData = tempCtx.getImageData(0, 0, COLS, ROWS).data;

    // Convert image pixels to grid
    for (let y = 0; y < ROWS; y++) {
      for (let x = 0; x < COLS; x++) {
        const index = (y * COLS + x) * 4;
        const r = imageData[index];
        const g = imageData[index + 1];
        const b = imageData[index + 2];
        const brightness = (r + g + b) / 3;

        grid[y][x] = brightness < 128 ? 1 : 0; // Dark = alive, light = dead
      }
    }

    drawGrid();
  };
});

drawGrid();
</script>

</body>
</html>
